<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How to Move a Device from One WebAccess/DMP Management Server to Another | WebAccess/DMP Documentation</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Open-source documentation for users of Advantech&amp;#39;s WebAccess/DMP software">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.46fba53b.css" as="style"><link rel="preload" href="/assets/js/app.dadd8c23.js" as="script"><link rel="preload" href="/assets/js/2.59ef54e9.js" as="script"><link rel="preload" href="/assets/js/12.92806b7b.js" as="script"><link rel="preload" href="/assets/js/15.d2a5ddba.js" as="script"><link rel="prefetch" href="/assets/js/10.f3ff0b8a.js"><link rel="prefetch" href="/assets/js/100.ed9c3b74.js"><link rel="prefetch" href="/assets/js/101.cb5c3001.js"><link rel="prefetch" href="/assets/js/102.6555fec3.js"><link rel="prefetch" href="/assets/js/103.a8e6d132.js"><link rel="prefetch" href="/assets/js/104.406745cb.js"><link rel="prefetch" href="/assets/js/105.0f22af6b.js"><link rel="prefetch" href="/assets/js/106.05868793.js"><link rel="prefetch" href="/assets/js/107.85f65fc7.js"><link rel="prefetch" href="/assets/js/108.1a8041e9.js"><link rel="prefetch" href="/assets/js/11.770cc47e.js"><link rel="prefetch" href="/assets/js/13.6b9e462f.js"><link rel="prefetch" href="/assets/js/14.ab7a494d.js"><link rel="prefetch" href="/assets/js/16.c8f36537.js"><link rel="prefetch" href="/assets/js/17.7b393edb.js"><link rel="prefetch" href="/assets/js/18.f0932c5b.js"><link rel="prefetch" href="/assets/js/19.ee450431.js"><link rel="prefetch" href="/assets/js/20.99c8f032.js"><link rel="prefetch" href="/assets/js/21.d6facd4e.js"><link rel="prefetch" href="/assets/js/22.a8598ac4.js"><link rel="prefetch" href="/assets/js/23.1399df76.js"><link rel="prefetch" href="/assets/js/24.93afd60b.js"><link rel="prefetch" href="/assets/js/25.2a17b234.js"><link rel="prefetch" href="/assets/js/26.03e4eb22.js"><link rel="prefetch" href="/assets/js/27.5ebcebd0.js"><link rel="prefetch" href="/assets/js/28.c8623cda.js"><link rel="prefetch" href="/assets/js/29.625b2fe9.js"><link rel="prefetch" href="/assets/js/3.a52db384.js"><link rel="prefetch" href="/assets/js/30.70fef511.js"><link rel="prefetch" href="/assets/js/31.08abd478.js"><link rel="prefetch" href="/assets/js/32.eb802096.js"><link rel="prefetch" href="/assets/js/33.f6b1596e.js"><link rel="prefetch" href="/assets/js/34.f8d27b44.js"><link rel="prefetch" href="/assets/js/35.f5047d74.js"><link rel="prefetch" href="/assets/js/36.893f9cd6.js"><link rel="prefetch" href="/assets/js/37.cd92543d.js"><link rel="prefetch" href="/assets/js/38.7970f454.js"><link rel="prefetch" href="/assets/js/39.02ff1f6d.js"><link rel="prefetch" href="/assets/js/4.d310de81.js"><link rel="prefetch" href="/assets/js/40.e2399857.js"><link rel="prefetch" href="/assets/js/41.9a4daa95.js"><link rel="prefetch" href="/assets/js/42.94e78ea2.js"><link rel="prefetch" href="/assets/js/43.1ccbaa9b.js"><link rel="prefetch" href="/assets/js/44.c6f63388.js"><link rel="prefetch" href="/assets/js/45.51a1b59f.js"><link rel="prefetch" href="/assets/js/46.6a5cd376.js"><link rel="prefetch" href="/assets/js/47.ab4c5efc.js"><link rel="prefetch" href="/assets/js/48.4c0e5a85.js"><link rel="prefetch" href="/assets/js/49.560e9b5a.js"><link rel="prefetch" href="/assets/js/5.48108a09.js"><link rel="prefetch" href="/assets/js/50.9e5c92d2.js"><link rel="prefetch" href="/assets/js/51.fb90ceed.js"><link rel="prefetch" href="/assets/js/52.ab90f623.js"><link rel="prefetch" href="/assets/js/53.7abb7365.js"><link rel="prefetch" href="/assets/js/54.e47f6b55.js"><link rel="prefetch" href="/assets/js/55.5a331162.js"><link rel="prefetch" href="/assets/js/56.644df4ca.js"><link rel="prefetch" href="/assets/js/57.7bf0f228.js"><link rel="prefetch" href="/assets/js/58.1517d131.js"><link rel="prefetch" href="/assets/js/59.1e5a4558.js"><link rel="prefetch" href="/assets/js/6.fa7ec479.js"><link rel="prefetch" href="/assets/js/60.0d53afd7.js"><link rel="prefetch" href="/assets/js/61.059bbe1b.js"><link rel="prefetch" href="/assets/js/62.3c419416.js"><link rel="prefetch" href="/assets/js/63.2ab666b1.js"><link rel="prefetch" href="/assets/js/64.8434a219.js"><link rel="prefetch" href="/assets/js/65.9b15726c.js"><link rel="prefetch" href="/assets/js/66.66a70a30.js"><link rel="prefetch" href="/assets/js/67.8da3de3f.js"><link rel="prefetch" href="/assets/js/68.f2184c5f.js"><link rel="prefetch" href="/assets/js/69.9a92d456.js"><link rel="prefetch" href="/assets/js/7.66c5a5e1.js"><link rel="prefetch" href="/assets/js/70.41f7078e.js"><link rel="prefetch" href="/assets/js/71.4a45313b.js"><link rel="prefetch" href="/assets/js/72.44913aed.js"><link rel="prefetch" href="/assets/js/73.7cad0080.js"><link rel="prefetch" href="/assets/js/74.19eb8498.js"><link rel="prefetch" href="/assets/js/75.3f2bb828.js"><link rel="prefetch" href="/assets/js/76.5ccc698e.js"><link rel="prefetch" href="/assets/js/77.b8e00e56.js"><link rel="prefetch" href="/assets/js/78.4a9ee68e.js"><link rel="prefetch" href="/assets/js/79.69edbd3e.js"><link rel="prefetch" href="/assets/js/8.480c9c1e.js"><link rel="prefetch" href="/assets/js/80.ba6d3c15.js"><link rel="prefetch" href="/assets/js/81.45f4ff72.js"><link rel="prefetch" href="/assets/js/82.1f4d790b.js"><link rel="prefetch" href="/assets/js/83.a4a6a089.js"><link rel="prefetch" href="/assets/js/84.78b9bc10.js"><link rel="prefetch" href="/assets/js/85.3c90ecf4.js"><link rel="prefetch" href="/assets/js/86.f061a520.js"><link rel="prefetch" href="/assets/js/87.418d020a.js"><link rel="prefetch" href="/assets/js/88.c4d10036.js"><link rel="prefetch" href="/assets/js/89.1fe8a715.js"><link rel="prefetch" href="/assets/js/9.8573547b.js"><link rel="prefetch" href="/assets/js/90.7c606e5a.js"><link rel="prefetch" href="/assets/js/91.5eb40f42.js"><link rel="prefetch" href="/assets/js/92.6327269d.js"><link rel="prefetch" href="/assets/js/93.58acd6fd.js"><link rel="prefetch" href="/assets/js/94.4ef4d3ee.js"><link rel="prefetch" href="/assets/js/95.2ca153a8.js"><link rel="prefetch" href="/assets/js/96.c780cd4f.js"><link rel="prefetch" href="/assets/js/97.ca4890b3.js"><link rel="prefetch" href="/assets/js/98.bcb723ab.js"><link rel="prefetch" href="/assets/js/99.f9b4441a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.46fba53b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/gen3/" class="home-link"><img src="/assets/img/logo.png" alt="WebAccess/DMP Documentation" class="logo"> <span class="site-name can-hide">
      Documentation
    </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <div class="version-switcher"><select><option selected="selected" value="Version 3.x.x">
      Version 3.x.x
    </option><option value="Version 2.x.x">
      Version 2.x.x
    </option></select></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/gen3/docs/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/gen3/release-notes/" class="nav-link">
  Release Notes (Server)
</a></div><div class="nav-item"><a href="/gen3/client/" class="nav-link">
  Release Notes (Client)
</a></div><div class="nav-item"><a href="/contact/" class="nav-link">
  Support &amp; Contact
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/gen3/docs/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/gen3/release-notes/" class="nav-link">
  Release Notes (Server)
</a></div><div class="nav-item"><a href="/gen3/client/" class="nav-link">
  Release Notes (Client)
</a></div><div class="nav-item"><a href="/contact/" class="nav-link">
  Support &amp; Contact
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/gen2/tutorials/" aria-current="page" class="sidebar-link">Sign Up</a></li><li><a href="/gen2/tutorials/ui-general-structure/" class="sidebar-link">General Structure of the User Interface</a></li><li><a href="/gen2/tutorials/create-company/" class="sidebar-link">Create New Companies</a></li><li><a href="/gen2/tutorials/create-users/" class="sidebar-link">Create More Users</a></li><li><a href="/gen2/tutorials/device/" class="sidebar-link">Claim a Device to Your Company</a></li><li><a href="/gen2/tutorials/search-filter-devices/" class="sidebar-link">Searching, Filtering and Sorting Devices</a></li><li><a href="/gen2/tutorials/configuring-router-apps/" class="sidebar-link">Installing/Upgrading Router Apps</a></li><li><a href="/gen2/tutorials/configuring-on_off-devices/" class="sidebar-link">Configuring Online and Offline Devices</a></li><li><a href="/gen2/tutorials/upgrade-fw/" class="sidebar-link">Upgrade Devices to the Latest Firmware</a></li><li><a href="/gen2/tutorials/move-a-device/" aria-current="page" class="active sidebar-link">How to Move a Device from One WebAccess/DMP Management Server to Another</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/gen2/tutorials/move-a-device/#introduction" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/gen2/tutorials/move-a-device/#background" class="sidebar-link">Background</a></li><li class="sidebar-sub-header"><a href="/gen2/tutorials/move-a-device/#client-configuration" class="sidebar-link">Client Configuration</a></li><li class="sidebar-sub-header"><a href="/gen2/tutorials/move-a-device/#option-1" class="sidebar-link">Option 1</a></li><li class="sidebar-sub-header"><a href="/gen2/tutorials/move-a-device/#option-2" class="sidebar-link">Option 2</a></li></ul></li><li class="sidebar-sub-header"><a href="/gen2/tutorials/move-a-device/#general-case" class="sidebar-link">General Case</a></li><li class="sidebar-sub-header"><a href="/gen2/tutorials/move-a-device/#procedure" class="sidebar-link">Procedure</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/gen2/tutorials/move-a-device/#step-1-tell-the-bootstrap-server-to-which-management-server-the-device-should-be-directed" class="sidebar-link">Step 1: Tell the Bootstrap Server to which Management Server the Device Should Be Directed</a></li><li class="sidebar-sub-header"><a href="/gen2/tutorials/move-a-device/#step-2-tell-the-new-management-server-to-trust-the-device-s-bootstrap-server" class="sidebar-link">Step 2: Tell the New Management Server to Trust the Device's Bootstrap Server</a></li><li class="sidebar-sub-header"><a href="/gen2/tutorials/move-a-device/#step-3-trigger-a-new-bootstrap-procedure" class="sidebar-link">Step 3: Trigger a New Bootstrap Procedure</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="how-to-move-a-device-from-one-webaccess-dmp-management-server-to-another"><a href="#how-to-move-a-device-from-one-webaccess-dmp-management-server-to-another" class="header-anchor">#</a> How to Move a Device from One WebAccess/DMP Management Server to Another</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <h3 id="background"><a href="#background" class="header-anchor">#</a> Background</h3> <p>WebAccess/DMP follows the <a href="https://www.omaspecworks.org/what-is-oma-specworks/iot/lightweight-m2m-lwm2m/" target="_blank" rel="noopener noreferrer">LightWeightM2M<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> protocol for &quot;Client-Initiated Bootstrap&quot;, using &quot;Certificate mode with Enrollment over Secure Transport&quot; for maximum security.</p> <p>You do not need to understand this procedure to follow it, but it may provide helpful background information.</p> <p>What you do need to understand is that a WebAccess/DMP server installation comprises several individual &quot;servers&quot;:</p> <p><img src="/assets/img/summary.a5a16c4c.png" alt="summary block diagram"></p> <p>The Bootstrap Server is used to direct the client to one or more Management Servers.</p> <p>During a bootstrap procedure, the Bootstrap Server provides two things to the client:</p> <ol><li>The address of the Management Server which will manage the device;</li> <li>A security certificate that the client can use to identify itself to that Management Server.</li></ol> <p>The Management Server performs all of the actual device management tasks: firmware upgrade, device configuration, device monitoring, etc.</p> <p>The Management Server may occasionally direct the client to download a file from the Content Server, but the Content Server is irrelevant for this discussion.</p> <h3 id="client-configuration"><a href="#client-configuration" class="header-anchor">#</a> Client Configuration</h3> <p>When a client on a device is starting for the first time, the only information it has is the address of a Bootstrap Server.</p> <p>The following image is a screenshot of the &quot;WebAccess/DMP Client&quot; Router Apps running on the local webserver of a router:</p> <p><img src="/assets/img/BS_URL.8047ebd1.png" alt="local webserver">
Note that there is no way to directly configure the client to point to a new Management Server.</p> <p>To move a device to a new Management Server, you have two choices.</p> <h3 id="option-1"><a href="#option-1" class="header-anchor">#</a> Option 1</h3> <p>Assuming you have access to the local web server on the device, you can change the Bootstrap Server Address in the Router App configuration screen.</p> <p><img src="/assets/img/2_servers_a.1f27016b.png" alt="option 1"></p> <p>However, there are disadvantages to this approach:</p> <ul><li>The configuration change can only be done manually;</li> <li>The device will forget everything about the original Bootstrap Server. If the initial connection to the new Bootstrap Server (on Server 2) fails, the device is lost;</li> <li>If the initial connection to the new Bootstrap Server (on Server 2) succeeds, but later Server 2 fails for some reason, it may not be possible to recover the device.</li></ul> <h3 id="option-2"><a href="#option-2" class="header-anchor">#</a> Option 2</h3> <p>Maintain the connection between the device and the original Bootstrap Server, but re-configure the Bootstrap Server to direct the device to the new Management Server.</p> <p><img src="/assets/img/2_servers_b.51796b3d.png" alt="option 2"></p> <p>Advantages:</p> <ul><li>The configuration change can be done via WebAccess/DMP itself and can therefore be automated for multiple devices;</li> <li>If Server 2 fails for some reason, the device will always fall back to the original Bootstrap Server for new instructions;</li> <li>This approach allows for new use-cases and business models. For example, you can temporarily move a device to a new Management Server, safe in knowing that when the new server dies, the device can be recovered.</li></ul> <p>The rest of this article will explain the procedure for this approach (Option 2).</p> <blockquote><p>Note:
This procedure has been automated in a Jupyter Notebook that is available in our public GitHub repo:
<a href="https://github.com/wadmp/wadmp.github.io/blob/master/jupyter_notebooks/move_device.ipynb" target="_blank" rel="noopener noreferrer">github.com/wadmp/wadmp.github.io/blob/master/jupyter_notebooks/move_device.ipynb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="general-case"><a href="#general-case" class="header-anchor">#</a> General Case</h2> <p>In the block diagrams above, we assume that the client on the device was initially configured to connect to the Bootstrap Server on Server 1.</p> <p>Usually, the requirement is to move the device to a second server (Server 2) and possibly move it back again (to Server 1) later.</p> <p>But we also need to consider the most general case. Imagine the device has already been moved from Server 1 to Server 2. Can we move it from Server 2 to Server 3? And from there to Server 4?</p> <p>The answer is yes. The key is that the device always remembers the URL of its original Bootstrap Server.</p> <p>In the <a href="https://github.com/wadmp/wadmp.github.io/blob/master/jupyter_notebooks/move_device.ipynb" target="_blank" rel="noopener noreferrer">Jupyter Notebook<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, you will see that the code handles the general case automatically. It refers to the original Bootstrap Server as &quot;Server 0&quot;.</p> <p>Usually, Server 0 <em>is</em> Server 1. So to avoid over-complicating things, we will make that assumption for the remainder of this document.</p> <h2 id="procedure"><a href="#procedure" class="header-anchor">#</a> Procedure</h2> <p>All of the following steps can be performed using the public REST API of both servers.</p> <p>You can follow along manually by using the &quot;OpenAPI&quot; (Swagger) documentation page, for example, <a href="https://api.wadmp.com" target="_blank" rel="noopener noreferrer">api.wadmp.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.
You should have an equivalent page for the second server instance.</p> <p>Alternatively, the whole procedure has been automated in a Jupyter Notebook that is available in our public GitHub repo: <a href="https://github.com/wadmp/wadmp.github.io/blob/master/jupyter_notebooks/move_device.ipynb" target="_blank" rel="noopener noreferrer">github.com/wadmp/wadmp.github.io/blob/master/jupyter_notebooks/move_device.ipynb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="step-1-tell-the-bootstrap-server-to-which-management-server-the-device-should-be-directed"><a href="#step-1-tell-the-bootstrap-server-to-which-management-server-the-device-should-be-directed" class="header-anchor">#</a> Step 1: Tell the Bootstrap Server to which Management Server the Device Should Be Directed</h3> <p>By default, in any particular WebAccess/DMP server deployment, the Bootstrap Server is configured to direct all devices to the Management Server co-located with the Bootstrap Server.</p> <p>In this step, you configure the Bootstrap Server on Server 1 to direct a device to a <em>different</em> Management Server: the Management Server on Server 2.</p> <h4 id="step-1a"><a href="#step-1a" class="header-anchor">#</a> Step 1a</h4> <p><strong><em>Using the Public API of Server 1 ...</em></strong></p> <p>In the Bootstrap section, send a POST request to &quot;/bootstrap&quot; to create a new Management Server definition:</p> <p><img src="/assets/img/POST_bootstrap.064f179a.png" alt="POST /bootstrap endpoint"></p> <ul><li>&quot;name&quot; is not essential: it only serves as a label or reminder for the user.</li> <li>&quot;address&quot; is the IP address or DNS name of the Management Server.</li> <li>&quot;port&quot; is the TCP port number of the Management Server. (Usually, 8883, which is the standard port number for MQTT over TLS.)
Finally, * &quot;company_id&quot; is your company ID in the system. (Can be obtained using the GET /companies endpoint if you don't know it already.)</li></ul> <h4 id="step-1b"><a href="#step-1b" class="header-anchor">#</a> Step 1b</h4> <p><strong><em>Using the Public API of Server 1 ...</em></strong></p> <p>In the Devices section, send a PUT request to &quot;/management/devices/{macAddress}/bootstrap-server/{serverId}&quot;, using the serverId obtained previously.</p> <p><img src="/assets/img/PUT_serverId.9a27d386.png" alt="POST /bootstrap endpoint"></p> <p>This means that the next time the devices perform a Bootstrap procedure, they will be directed to the new Management Server.</p> <p>But we are not ready to re-direct it yet.</p> <h3 id="step-2-tell-the-new-management-server-to-trust-the-device-s-bootstrap-server"><a href="#step-2-tell-the-new-management-server-to-trust-the-device-s-bootstrap-server" class="header-anchor">#</a> Step 2: Tell the New Management Server to Trust the Device's Bootstrap Server</h3> <p>The Management Server uses TLS with mutual authentication. i.e., The client must present a digital certificate. Furthermore, the Management Server must trust the <em>issuer</em> of this certificate.</p> <p>By default, the Bootstrap Server co-located with a Management Server is automatically trusted by that Management Server.</p> <p>However, if your device has been directed to a <em>new</em> Management Server, then by default, that Management Server will <em>not</em> allow the device to connect because the client certificate presented was issued by an unknown Bootstrap Server.</p> <p>You must update the &quot;trust store&quot; of the new Management Server with the certificates used by the device's Bootstrap Server.</p> <h4 id="step-2a"><a href="#step-2a" class="header-anchor">#</a> Step 2a</h4> <p><strong><em>Using the Public API of Server 1 ...</em></strong></p> <p>In the Bootstrap section, use the &quot;GET /certs&quot; endpoint to check what certificates are in the trust store of the current Management Server. i.e., The Management Server on Server 1, where the device is currently connected.</p> <p><img src="/assets/img/GET_certs.10bc24fe.png" alt="GET /certs endpoint"></p> <blockquote><p><strong>Permissions</strong></p> <p>To use the &quot;GET /certs&quot; endpoint, you must have the &quot;Device Management Server&quot; permission on Server 1.</p> <p>In the WebAccess/DMP UI, you can view and modify the permissions of any user (on a per-company basis):</p> <p><img src="/assets/img/permission.6f61bf00.png" alt="The permissions screen in the UI"></p> <p>Alternatively, using the Public API, you can view permissions using the &quot;GET /users/{id}&quot; endpoint and modify them using the &quot;PUT /users/{id}/companies&quot; endpoint.</p></blockquote> <p>The &quot;GET /certs&quot; request will return a JSON object like this:</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;data&quot;: {
      &quot;certs&quot;: &quot;LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0t...VElGSUNBVEUtLS0tLQo=&quot;
   },
   &quot;success&quot;: true
}
</code></pre></div><p>&quot;certs&quot; is a Base64-encoded string. You can decode it using a web service like <a href="https://www.base64decode.org/" target="_blank" rel="noopener noreferrer">www.base64decode.org/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>When decoded, you will see that it is a PEM file containing several X.509 certificates, usually three:</p> <div class="language- extra-class"><pre class="language-text"><code>-----BEGIN CERTIFICATE-----
MIICzTCCAnOgAwIBAgIUHAGWV7GFmEummqHfcDEEr4HyM2MwCgYIKoZIzj0EAwIw
gbMxCzAJBgNVBAYTAklFMQ8wDQYDVQQIDAZHYWx3YXkxETAPBgNVBAcMCE9yYW5t
...
DyWJ466GETl5oF8b036sAiBty23FHKQLWSa7v6Cl13LNPOP66FRDt0jneNZHF7QE
wA==
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIICyDCCAm2gAwIBAgICEAEwCgYIKoZIzj0EAwIwgboxCzAJBgNVBAYTAklFMQ8w
DQYDVQQIDAZHYWx3YXkxIDAeBgNVBAoMF0FkdmFudGVjaCBCK0IgU21hcnRXb3J4
...
BAMCAYYwCgYIKoZIzj0EAwIDSQAwRgIhAMZNGdhH1KOm33dA8yibKUQK8uDtKoJJ
1zphLoEB3iOhAiEA9HOyt8t83eEGrdsL2Zdd9PaBaoK21MqU7vjA96L6xIM=
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIICxjCCAmugAwIBAgICEAAwCgYIKoZIzj0EAwIwgbMxCzAJBgNVBAYTAklFMQ8w
DQYDVQQIDAZHYWx3YXkxETAPBgNVBAcMCE9yYW5tb3JlMSAwHgYDVQQKDBdBZHZh
...
AgGGMAoGCCqGSM49BAMCA0kAMEYCIQDVUuB//bFW1T900osnQgElyQq8Qe3uPG0h
z6CnvTPHCAIhAKcu4nnZydZg1PTYwOZjZ54P5t+eIJKr3cL1Ts3J9Shb
-----END CERTIFICATE-----
</code></pre></div><blockquote><p><strong>Optional step</strong></p> <p>If you are interested, you can split the file into individual certs and then use OpenSSL command-line tools to examine them:</p> <p><code>$ openssl x509 -in &lt;cert&gt; -text -noout</code></p> <p>You will see that the certificates are chained and end in a self-signed root CA cert.
This is the trust anchor for device authentication.</p></blockquote> <blockquote><p><strong>Background info.</strong></p> <p>If you are <em>really</em> interested 😃, you should know that there is another way to check the Management Server's trust store without using the API.</p> <p>During the TLS (v1.2) handshake, the server sends a &quot;Certificate Request&quot; message to the client.
This message includes the client Certificate Authorities listed in the server’s trust store.</p> <p>If you use the <code>openssl s_client</code> command to connect to the Management Server, the output will include &quot;Acceptable client certificate CA names&quot;, already decoded for you:</p> <p><code>$ openssl s_client -connect management.wadmp.com:8883 -CAfile /opt/projects/pki/server/SCA0/certs/ca.cert.pem -tls1_2</code></p> <p><code>CONNECTED(00000005)</code></p> <p><code>depth=3 C = IE, ST = Galway, L = Oranmore, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = Falcon Server Root CA (SCA0), emailAddress = bbcmsmanager@advantech.com</code></p> <p><code>verify return:1</code></p> <p><code>depth=2 C = IE, ST = Galway, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = Falcon Server Intermediate Level-1 CA (SCA1_production), emailAddress = webaccessdmp@advantech.com</code></p> <p><code>verify return:1</code></p> <p><code>depth=1 C = IE, ST = Galway, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = Falcon Server CA for Production (SCA2_production), emailAddress = webaccessdmp@advantech.com</code></p> <p><code>verify return:1</code></p> <p><code>depth=0 C = IE, ST = Galway, L = Oranmore, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = &quot;WADMP Management Server, Production Cloud&quot;, emailAddress = webaccessdmp@advantech.com</code></p> <p><code>verify return:1</code></p> <p><code>140025034838464:error:14094410:SSL routines:ssl3_read_bytes:sslv3 alert handshake failure:../ssl/record/rec_layer_s3.c:1528:SSL alert number 40</code></p> <p><code>---</code></p> <p><code>Certificate chain</code></p> <p><code>0 s:C = IE, ST = Galway, L = Oranmore, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = &quot;WADMP Management Server, Production Cloud&quot;, emailAddress = webaccessdmp@advantech.com</code></p> <p><code>i:C = IE, ST = Galway, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = Falcon Server CA for Production (SCA2_production), emailAddress = webaccessdmp@advantech.com</code></p> <p><code>1 s:C = IE, ST = Galway, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = Falcon Server CA for Production (SCA2_production), emailAddress = webaccessdmp@advantech.com</code></p> <p><code>i:C = IE, ST = Galway, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = Falcon Server Intermediate Level-1 CA (SCA1_production), emailAddress = webaccessdmp@advantech.com</code></p> <p><code>2 s:C = IE, ST = Galway, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = Falcon Server Intermediate Level-1 CA (SCA1_production), emailAddress = webaccessdmp@advantech.com</code></p> <p><code>i:C = IE, ST = Galway, L = Oranmore, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = Falcon Server Root CA (SCA0), emailAddress = bbcmsmanager@advantech.com</code></p> <p><code>---</code></p> <p><code>Server certificate</code></p> <p><code>-----BEGIN CERTIFICATE-----</code></p> <p><code>MIIDSTCCAvCgAwIBAgICEAEwCgYIKoZIzj0EAwIwgbUxCzAJBgNVBAYTAklFMQ8w</code></p> <p><code>DQYDVQQIDAZHYWx3YXkxIDAeBgNVBAoMF0FkdmFudGVjaCBCK0IgU21hcnRXb3J4</code></p> <p><code>MQwwCgYDVQQLDANJb1QxOjA4BgNVBAMMMUZhbGNvbiBTZXJ2ZXIgQ0EgZm9yIFBy</code></p> <p><code>b2R1Y3Rpb24gKFNDQTJfcHJvZHVjdGlvbikxKTAnBgkqhkiG9w0BCQEWGndlYmFj</code></p> <p><code>Y2Vzc2RtcEBhZHZhbnRlY2guY29tMB4XDTE5MTAwMzEzMjc1NloXDTIwMTAwMjEz</code></p> <p><code>Mjc1NlowgcAxCzAJBgNVBAYTAklFMQ8wDQYDVQQIDAZHYWx3YXkxETAPBgNVBAcM</code></p> <p><code>CE9yYW5tb3JlMSAwHgYDVQQKDBdBZHZhbnRlY2ggQitCIFNtYXJ0V29yeDEMMAoG</code></p> <p><code>A1UECwwDSW9UMTIwMAYDVQQDDClXQURNUCBNYW5hZ2VtZW50IFNlcnZlciwgUHJv</code></p> <p><code>ZHVjdGlvbiBDbG91ZDEpMCcGCSqGSIb3DQEJARYad2ViYWNjZXNzZG1wQGFkdmFu</code></p> <p><code>dGVjaC5jb20wWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASFexFsIrjfKwEufq1M</code></p> <p><code>qgHlosaPLhAerIAtEb4lnwBMr22b+7WhnCIqlDCyTteRuXGZYuftNEaGQL/xQkKr</code></p> <p><code>7/tRo4HiMIHfMAkGA1UdEwQCMAAwEQYJYIZIAYb4QgEBBAQDAgZAMDMGCWCGSAGG</code></p> <p><code>+EIBDQQmFiRPcGVuU1NMIEdlbmVyYXRlZCBTZXJ2ZXIgQ2VydGlmaWNhdGUwHQYD</code></p> <p><code>VR0OBBYEFGPi8TycsTD6SUrV3BwDkb5/XugjMB8GA1UdIwQYMBaAFCucwq3rviWz</code></p> <p><code>QYQ2/+o0S3xrtqRZMA4GA1UdDwEB/wQEAwIFoDATBgNVHSUEDDAKBggrBgEFBQcD</code></p> <p><code>ATAlBgNVHREEHjAcghRtYW5hZ2VtZW50LndhZG1wLmNvbYcEDU/2KTAKBggqhkjO</code></p> <p><code>PQQDAgNHADBEAiA0M6lBmeiXfW9wmD/UOptPd+jeRAd+H4xutW3ZUBOwjAIgBKeD</code></p> <p><code>ZD/bDFx1a1mT3+F977T5LQNWMUxxLLtJsQDtWDo=</code></p> <p><code>-----END CERTIFICATE-----</code></p> <p><code>subject=C = IE, ST = Galway, L = Oranmore, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = &quot;WADMP Management Server, Production Cloud&quot;, emailAddress = webaccessdmp@advantech.com</code></p> <p><code>issuer=C = IE, ST = Galway, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = Falcon Server CA for Production (SCA2_production), emailAddress = webaccessdmp@advantech.com</code></p> <p><code>---</code></p> <p><strong><code>Acceptable client certificate CA names</code></strong></p> <p><code>C = IE, ST = Galway, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = Falcon Device CA for Production (DCA2_production), emailAddress = webaccessdmp@advantech.com</code></p> <p><code>C = IE, ST = Galway, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = Falcon Device Intermediate Level-1 CA (DCA1_production), emailAddress = webaccessdmp@advantech.com</code></p> <p><code>C = IE, ST = Galway, L = Oranmore, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = Falcon Device Root CA (DCA0), emailAddress = bbcmsmanager@advantech.com</code></p> <p><code>C = IE, ST = Galway, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = Falcon Device CA for Development Environment (DCA2_develop), emailAddress = bbcmsmanager@advantech.com</code></p> <p><code>C = IE, ST = Galway, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = Falcon Test Device Intermediate Level-1 CA (DCA1_test), emailAddress = bbcmsmanager@advantech.com</code></p> <p><code>C = IE, ST = Galway, L = Oranmore, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = Falcon User CA (UCA_Advantech1), emailAddress = ben.kinsella@advantech.com</code></p> <p><code>C = IE, ST = Galway, O = &quot;Advantech B+B SmartWorx&quot;, OU = IoT, CN = WADMP Device CA for Staging, emailAddress = webaccessdmp@advantech.com</code></p> <p><code>Client Certificate Types: RSA sign, DSA sign, ECDSA sign</code></p> <p><code>Requested Signature Algorithms: ECDSA+SHA256:ECDSA+SHA384:ECDSA+SHA512:Ed25519:Ed448:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA+SHA256:RSA+SHA384:RSA+SHA512:ECDSA+SHA224:ECDSA+SHA1:RSA+SHA224:RSA+SHA1:DSA+SHA224:DSA+SHA1:DSA+SHA256:DSA+SHA384:DSA+SHA512</code></p> <p><code>Shared Requested Signature Algorithms: ECDSA+SHA256:ECDSA+SHA384:ECDSA+SHA512:Ed25519:Ed448:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA+SHA256:RSA+SHA384:RSA+SHA512:ECDSA+SHA224:ECDSA+SHA1:RSA+SHA224:RSA+SHA1:DSA+SHA224:DSA+SHA1:DSA+SHA256:DSA+SHA384:DSA+SHA512</code></p> <p><code>Peer signing digest: SHA256</code></p> <p><code>Peer signature type: ECDSA</code></p> <p><code>Server Temp Key: X25519, 253 bits</code></p> <p><code>---</code></p> <p><code>SSL handshake has read 3867 bytes and written 328 bytes</code></p> <p><code>Verification: OK</code></p> <p><code>---</code></p> <p><code>New, TLSv1.2, Cipher is ECDHE-ECDSA-AES256-GCM-SHA384</code></p> <p><code>Server public key is 256 bit</code></p> <p><code>Secure Renegotiation IS supported</code></p> <p><code>Compression: NONE</code></p> <p><code>Expansion: NONE</code></p> <p><code>No ALPN negotiated</code></p> <p><code>SSL-Session:</code></p> <p><code>Protocol : TLSv1.2</code></p> <p><code>Cipher : ECDHE-ECDSA-AES256-GCM-SHA384</code></p> <p><code>Session-ID:</code></p> <p><code>Session-ID-ctx:</code></p> <p><code>Master-Key: C92E036601E64921EA5F20D39A0A9FF53A3B6BDB709DD2819A4AF7A968D1E6F0AF7961593E0792139B7B15EEC5340E78</code></p> <p><code>PSK identity: None</code></p> <p><code>PSK identity hint: None</code></p> <p><code>SRP username: None</code></p> <p><code>Start Time: 1590769106</code></p> <p><code>Timeout : 7200 (sec)</code></p> <p><code>Verify return code: 0 (ok)</code></p> <p><code>Extended master secret: yes</code></p> <p><code>---</code></p></blockquote> <h4 id="step-2b"><a href="#step-2b" class="header-anchor">#</a> Step 2b</h4> <p><strong><em>Using the Public API of Server 2 ...</em></strong></p> <p>Use the same &quot;GET /certs&quot; endpoint on Server 2 to check what certificates are in the trust store of the <em>new</em> Management Server.</p> <p>Decode the &quot;certs&quot; string as before.</p> <h4 id="step-2c"><a href="#step-2c" class="header-anchor">#</a> Step 2c</h4> <p>Any certificate in Server 1 that is NOT already in Server 2 must be added to Server 2.</p> <p>Copy and paste the concatenated certificates into a web service like <a href="https://www.base64encode.org/" target="_blank" rel="noopener noreferrer">www.base64encode.org/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The order of the certificates doesn't matter.</p> <p><strong><em>Using the Public API of Server 2 ...</em></strong></p> <p>In the Bootstrap section, use the &quot;PUT /certs&quot; endpoint to upload the new Base64-encoded string as &quot;certs&quot;.</p> <p>i.e., Pass the following JSON object in the body:</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;certs&quot;: &quot;&lt;new Base64-encoded string including new certs&gt;&quot;
}
</code></pre></div><p><img src="/assets/img/GET_certs.10bc24fe.png" alt="GET /certs endpoint"></p> <blockquote><p><strong>Permissions</strong></p> <p>To use the &quot;PUT /certs&quot; endpoint, you must be a SysAdmin on Server 2.</p> <ul><li><p>If your Server 2 instance is an On-Premises installation of WebAccess/DMP, there will be a SysAdmin user within your organization.</p></li> <li><p>If your Server 2 instance is the public cloud installation of WebAccess/DMP (www.wadmp.com), only Advantech SysAdmin has permission to perform this step.</p></li></ul></blockquote> <blockquote><p><strong>Optional step</strong></p> <p>If you used the <code>openssl s_client</code> command earlier, you could rerun it now, and you should find the new client CA(s) listed under &quot;Acceptable client certificate CA names&quot;.</p></blockquote> <h3 id="step-3-trigger-a-new-bootstrap-procedure"><a href="#step-3-trigger-a-new-bootstrap-procedure" class="header-anchor">#</a> Step 3: Trigger a New Bootstrap Procedure</h3> <p><strong><em>Using the Public API of Server 1 ...</em></strong></p> <p>In the Devices section, use the &quot;POST /management/devices/{macAddress}/commands/trigger-bootstrap&quot; endpoint to command the device to initiate a new bootstrap process:</p> <p><img src="/assets/img/POST_trigger-bootstrap.3d919761.png" alt="POST /trigger-bootstrap endpoint"></p> <p>The device will receive a new certificate from the Bootstrap Server, and it will also receive the address of the new Management Server (on Server 2).</p> <p>It will attempt to connect to Server 2 immediately.</p> <p>The connection will be successful if:</p> <ol><li><p>The X.509 certificates were copied to Server 2 as described in this procedure;</p></li> <li><p>The device identity exists in Server 2. i.e., Use the &quot;Create Device&quot; screen in the WebAccess/DMP UI or the &quot;POST /identity/devices&quot; endpoint in the API.</p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/gen2/tutorials/upgrade-fw/" class="prev">
        Upgrade Devices to the Latest Firmware
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.dadd8c23.js" defer></script><script src="/assets/js/2.59ef54e9.js" defer></script><script src="/assets/js/12.92806b7b.js" defer></script><script src="/assets/js/15.d2a5ddba.js" defer></script>
  </body>
</html>
