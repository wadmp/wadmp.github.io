<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Device Desired and Reported states | WebAccess/DMP Documentation</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="Open-source documentation for users of Advantech&amp;#39;s WebAccess/DMP software">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.46fba53b.css" as="style"><link rel="preload" href="/assets/js/app.e1876cb4.js" as="script"><link rel="preload" href="/assets/js/2.7fa3ab1c.js" as="script"><link rel="preload" href="/assets/js/11.1c0925e2.js" as="script"><link rel="preload" href="/assets/js/21.9f4b6e13.js" as="script"><link rel="prefetch" href="/assets/js/10.d0e2259d.js"><link rel="prefetch" href="/assets/js/100.6d94d7c5.js"><link rel="prefetch" href="/assets/js/101.f0745e58.js"><link rel="prefetch" href="/assets/js/102.8d075653.js"><link rel="prefetch" href="/assets/js/103.0d1ee5e8.js"><link rel="prefetch" href="/assets/js/12.b92884e6.js"><link rel="prefetch" href="/assets/js/13.733b1146.js"><link rel="prefetch" href="/assets/js/14.d4df44ca.js"><link rel="prefetch" href="/assets/js/15.00480880.js"><link rel="prefetch" href="/assets/js/16.4e199fa9.js"><link rel="prefetch" href="/assets/js/17.753fc0c7.js"><link rel="prefetch" href="/assets/js/18.4758946a.js"><link rel="prefetch" href="/assets/js/19.dda924bc.js"><link rel="prefetch" href="/assets/js/20.dfda1357.js"><link rel="prefetch" href="/assets/js/22.81101013.js"><link rel="prefetch" href="/assets/js/23.c1e2c59e.js"><link rel="prefetch" href="/assets/js/24.17d92dfd.js"><link rel="prefetch" href="/assets/js/25.d30fca37.js"><link rel="prefetch" href="/assets/js/26.88e74998.js"><link rel="prefetch" href="/assets/js/27.d48e2e2c.js"><link rel="prefetch" href="/assets/js/28.cbe8d786.js"><link rel="prefetch" href="/assets/js/29.454581ad.js"><link rel="prefetch" href="/assets/js/3.6fd5a4ac.js"><link rel="prefetch" href="/assets/js/30.3dde8a88.js"><link rel="prefetch" href="/assets/js/31.dc6a2f9b.js"><link rel="prefetch" href="/assets/js/32.4fc1ce2f.js"><link rel="prefetch" href="/assets/js/33.611c7aff.js"><link rel="prefetch" href="/assets/js/34.b74b8e9f.js"><link rel="prefetch" href="/assets/js/35.91bea22a.js"><link rel="prefetch" href="/assets/js/36.bed36d4f.js"><link rel="prefetch" href="/assets/js/37.cfe139b8.js"><link rel="prefetch" href="/assets/js/38.f007f1ea.js"><link rel="prefetch" href="/assets/js/39.3586c6ba.js"><link rel="prefetch" href="/assets/js/4.bc814835.js"><link rel="prefetch" href="/assets/js/40.ee72aebd.js"><link rel="prefetch" href="/assets/js/41.ecfbd310.js"><link rel="prefetch" href="/assets/js/42.2ebdd1af.js"><link rel="prefetch" href="/assets/js/43.9a6b5bfb.js"><link rel="prefetch" href="/assets/js/44.615c696d.js"><link rel="prefetch" href="/assets/js/45.acf95144.js"><link rel="prefetch" href="/assets/js/46.ceb25b61.js"><link rel="prefetch" href="/assets/js/47.070be4c6.js"><link rel="prefetch" href="/assets/js/48.2cf6cd80.js"><link rel="prefetch" href="/assets/js/49.099e4e27.js"><link rel="prefetch" href="/assets/js/5.a0c5198d.js"><link rel="prefetch" href="/assets/js/50.d51e5416.js"><link rel="prefetch" href="/assets/js/51.12e8d3a5.js"><link rel="prefetch" href="/assets/js/52.71233f6f.js"><link rel="prefetch" href="/assets/js/53.d878623a.js"><link rel="prefetch" href="/assets/js/54.7b6c8b9f.js"><link rel="prefetch" href="/assets/js/55.9738c004.js"><link rel="prefetch" href="/assets/js/56.197ebf8c.js"><link rel="prefetch" href="/assets/js/57.992706d5.js"><link rel="prefetch" href="/assets/js/58.99a9242b.js"><link rel="prefetch" href="/assets/js/59.c9e3a53e.js"><link rel="prefetch" href="/assets/js/6.ff388490.js"><link rel="prefetch" href="/assets/js/60.de7e37d9.js"><link rel="prefetch" href="/assets/js/61.8ac78e30.js"><link rel="prefetch" href="/assets/js/62.e98f34dc.js"><link rel="prefetch" href="/assets/js/63.6149199f.js"><link rel="prefetch" href="/assets/js/64.81cc7926.js"><link rel="prefetch" href="/assets/js/65.f2838698.js"><link rel="prefetch" href="/assets/js/66.4672ccbc.js"><link rel="prefetch" href="/assets/js/67.e8824156.js"><link rel="prefetch" href="/assets/js/68.8bcf775b.js"><link rel="prefetch" href="/assets/js/69.bd774ddb.js"><link rel="prefetch" href="/assets/js/7.c4c7ebe9.js"><link rel="prefetch" href="/assets/js/70.e0294cb7.js"><link rel="prefetch" href="/assets/js/71.99e9bcb0.js"><link rel="prefetch" href="/assets/js/72.a5a16a8d.js"><link rel="prefetch" href="/assets/js/73.61e58b82.js"><link rel="prefetch" href="/assets/js/74.af79fe55.js"><link rel="prefetch" href="/assets/js/75.57771205.js"><link rel="prefetch" href="/assets/js/76.ad78e616.js"><link rel="prefetch" href="/assets/js/77.7f041bde.js"><link rel="prefetch" href="/assets/js/78.81615c0e.js"><link rel="prefetch" href="/assets/js/79.ab7074d9.js"><link rel="prefetch" href="/assets/js/8.1ae88809.js"><link rel="prefetch" href="/assets/js/80.63640846.js"><link rel="prefetch" href="/assets/js/81.c4232374.js"><link rel="prefetch" href="/assets/js/82.7fce5645.js"><link rel="prefetch" href="/assets/js/83.d8bf5069.js"><link rel="prefetch" href="/assets/js/84.81bd1e83.js"><link rel="prefetch" href="/assets/js/85.34902bb3.js"><link rel="prefetch" href="/assets/js/86.9456cc09.js"><link rel="prefetch" href="/assets/js/87.ffb40b7c.js"><link rel="prefetch" href="/assets/js/88.df48efe7.js"><link rel="prefetch" href="/assets/js/89.3aefa364.js"><link rel="prefetch" href="/assets/js/9.c064e712.js"><link rel="prefetch" href="/assets/js/90.eb88b608.js"><link rel="prefetch" href="/assets/js/91.a58be8ab.js"><link rel="prefetch" href="/assets/js/92.4b1de364.js"><link rel="prefetch" href="/assets/js/93.b43531be.js"><link rel="prefetch" href="/assets/js/94.170a9252.js"><link rel="prefetch" href="/assets/js/95.6666374e.js"><link rel="prefetch" href="/assets/js/96.2e4bad6e.js"><link rel="prefetch" href="/assets/js/97.da2fd73c.js"><link rel="prefetch" href="/assets/js/98.3b16e321.js"><link rel="prefetch" href="/assets/js/99.791d6392.js">
    <link rel="stylesheet" href="/assets/css/0.styles.46fba53b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/gen3/" class="home-link"><img src="/assets/img/logo.png" alt="WebAccess/DMP Documentation" class="logo"> <span class="site-name can-hide">
      Documentation
    </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <div class="version-switcher"><select><option selected="selected" value="Version 3.x.x">
      Version 3.x.x
    </option><option value="Version 2.x.x">
      Version 2.x.x
    </option></select></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/gen3/docs/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/gen3/release-notes/" class="nav-link">
  Release Notes (Server)
</a></div><div class="nav-item"><a href="/gen3/client/" class="nav-link">
  Release Notes (Client)
</a></div><div class="nav-item"><a href="/contact/" class="nav-link">
  Support &amp; Contact
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/gen3/docs/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="/gen3/release-notes/" class="nav-link">
  Release Notes (Server)
</a></div><div class="nav-item"><a href="/gen3/client/" class="nav-link">
  Release Notes (Client)
</a></div><div class="nav-item"><a href="/contact/" class="nav-link">
  Support &amp; Contact
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/gen2/explanations/" aria-current="page" class="active sidebar-link">Device Desired and Reported states</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/gen2/explanations/#how-it-works" class="sidebar-link">How It Works</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/gen2/explanations/#dmp-client" class="sidebar-link">DMP Client</a></li><li class="sidebar-sub-header"><a href="/gen2/explanations/#applying-configuration-changes" class="sidebar-link">Applying Configuration Changes</a></li><li class="sidebar-sub-header"><a href="/gen2/explanations/#everything-is-an-application" class="sidebar-link">Everything is an Application</a></li></ul></li><li class="sidebar-sub-header"><a href="/gen2/explanations/#how-to-use-desired-and-reported-states" class="sidebar-link">How to Use Desired and Reported States</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/gen2/explanations/#re-applying-configuration-with-syncengine" class="sidebar-link">Re-Applying Configuration With SyncEngine</a></li></ul></li></ul></li><li><a href="/gen2/explanations/companies-and-users/" class="sidebar-link">Companies and Users</a></li><li><a href="/gen2/explanations/permissions/" class="sidebar-link">Permissions Explained</a></li><li><a href="/gen2/explanations/cellular-data-usage/" class="sidebar-link">Cellular Data Usage</a></li><li><a href="/gen2/explanations/grouping-and-tagging/" class="sidebar-link">Tagging and Grouping</a></li><li><a href="/gen2/explanations/billing/" class="sidebar-link">Billing Explained</a></li><li><a href="/gen2/explanations/playbooks/" class="sidebar-link">Playbooks Explained</a></li><li><a href="/gen2/explanations/grafana/" class="sidebar-link">Grafana - Company Dashboard, Device Dashboard</a></li><li><a href="/gen2/explanations/alerts/" class="sidebar-link">Alerts Explained</a></li><li><a href="/gen2/explanations/2fa/" class="sidebar-link">Two-Factor Authentication</a></li><li><a href="/gen2/explanations/auditing-options/" class="sidebar-link">Auditing Explained</a></li><li><a href="/gen2/explanations/cant-connect-my-device/" class="sidebar-link">I Cannot Connect My Device</a></li><li><a href="/gen2/explanations/adding-or-claiming-devices-in-bulk/" class="sidebar-link">Adding / Claiming Devices in Bulk</a></li><li><a href="/gen2/explanations/bunch-claiming-devices/" class="sidebar-link">Bunch Claiming Devices Using Script</a></li><li><a href="/gen2/explanations/wadmp-ports/" class="sidebar-link">WADMP Ports / Addresses</a></li><li><a href="/gen2/explanations/Migration%20from%202.x.x%20to%203.x.x%20instance/" class="sidebar-link">Migration from 2.x.x to 3.x.x Instance</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="device-desired-and-reported-states"><a href="#device-desired-and-reported-states" class="header-anchor">#</a> Device Desired and Reported states</h1> <p>To configure a device, you need access to it, either to its web server or through SSH. When connected to a device, all changes made are immediately applied, and, if needed, services are restarted.</p> <p>Remote device configuration, on the other hand, is a different business. It adds a second actor that can receive configuration changes and send them to the device. This raises new issues: Will this actor save a copy of all the properties or request them to the device every time? What if the device is temporarily not available? These and other questions are addressed by the solution DMP implemented. Desired and Reported states are not a new idea, especially now that cloud management of IoT devices is increasingly popular. We took pictures from other solutions but aimed to make ours lightweight and straightforward.</p> <p>If you are curious about the ideas behind them, please visit the documentation for the following projects:</p> <ul><li><a href="https://aws.amazon.com/iot-platform/how-it-works/" target="_blank" rel="noopener noreferrer">AWS IoT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and its implementation of <a href="http://docs.aws.amazon.com/iot/latest/developerguide/iot-thing-shadows.html" target="_blank" rel="noopener noreferrer">Device Shadows<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-what-is-iot-hub" target="_blank" rel="noopener noreferrer">Azure IoT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and the similar <a href="https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-devguide-device-twins" target="_blank" rel="noopener noreferrer">Device Twins<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://www.eclipse.org/ditto/intro-overview.html" target="_blank" rel="noopener noreferrer">Eclipse Ditto<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> also provides a similar solution.</li></ul> <h2 id="how-it-works"><a href="#how-it-works" class="header-anchor">#</a> How It Works</h2> <p><img src="/assets/img/desired-reported.fad86348.png" alt="Desired Reported" title="Desired and Reported states"></p> <p>DMP defines two sets of configuration:</p> <ul><li>The Desired state or changes a user wants to make on a device and</li> <li>The Reported state, the configuration the device reports to DMP</li></ul> <p>In this model, the user can only modify the Desired state, while the Reported is only by the device. DMP is in charge of sending the difference between the two to the device, so eventually, both Desired and Reported are the same. Devices are the source of truth, so the Desired state has to be updated at any change so DMP can make correct decisions.</p> <p>Two things are implied in this explanation:
The device needs a process capable of monitoring changes to report them and also be able to apply modifications received from DMP.
DMP also needs to be able to send changes to the device, possibly waiting for the device to connect.
If the device doesn't apply the changes, DMP should be able to re-apply them.</p> <h3 id="dmp-client"><a href="#dmp-client" class="header-anchor">#</a> DMP Client</h3> <p>Routers allow extensibility through <a href="/references/routers-overview.html">Router Apps</a>. We created the &quot;WebAccess/DMP client&quot; Router App to be the service that updates DMP when the router changes and applies all changes sent by DMP, among other tasks. It maintains a connection with DMP using the <a href="/explanations-discussions/what-is-webaccess-dmp.html">MQTT protocol</a> so changes on both sides can be reported to the other end.</p> <p>Because the router is the source of truth when this client connects, it reports all its configurations. This allows DMP to have a detailed report of all the changes when the device was disconnected.</p> <p>Configuration on routers is naturally separated into sections, so we take advantage of it by sending to DMP all the properties of that section only. This allows for less information exchanged and is a practical difference from the other similar solutions.</p> <p>The client knows where the changes need to be applied and what extra steps need to be taken. When finished, it reports back the changed configuration.</p> <h3 id="applying-configuration-changes"><a href="#applying-configuration-changes" class="header-anchor">#</a> Applying Configuration Changes</h3> <p>Every time the Desired state is changed, DMP will determine the difference with the reported state and send it to the device. If the device is online, it will receive the change immediately, but if it is offline, all subsequent changes will be merged into the Desired state. When the device connects again, it will receive only one change request per section modified.
This behavior has a downside. For example, if a user wants to apply a set of changes, wait or request a reboot, and then use other modifications to the same section while the device is offline, all changes will be merged into one request only. In this exceptional scenario, the user should wait for the device to reboot before applying the second set of changes.</p> <h3 id="everything-is-an-application"><a href="#everything-is-an-application" class="header-anchor">#</a> Everything is an Application</h3> <p>DMP treats both Firmware and Router Apps as applications. An application is a versioned set of properties grouped in sections. It can be replaced by a different version that may have a different set of properties. The Firmware is still a unique application because it is related to the device type and cannot be uninstalled.
This simplification allows to use of Desired and Reported states in all applications.</p> <h2 id="how-to-use-desired-and-reported-states"><a href="#how-to-use-desired-and-reported-states" class="header-anchor">#</a> How to Use Desired and Reported States</h2> <p>DMP groups all properties into sections. The DMP UI reflects this on the left column of the configuration screen:
<img src="/assets/img/device-configuration.edc80b46.png" alt="Device configuration" title="UI Device configuration">
The desired value always takes priority in the UI. The reported is shown only if it is different from the reported (like the &quot;Name&quot; property above, that was changed but not saved) or if there is no desired value. This simplified view allows focusing on what the user wants to change, showing details about the reported data only when relevant.</p> <p>On the other hand, the API exposes all values to the user, processing and presenting them more appropriately. Moreover, the API allows a user more control over the presentation as the way to do it is not imposed by DMP.</p> <p>The following endpoints are the ones that allow us to interact with Desired and Reported states:
<img src="/assets/img/desired-reported-endpoints.b6311902.png" alt="Desired Reported endpoints" title="Desired and Reported endpoints"></p> <p>For example, the image of the UI above called the following endpoint to get the Desired and Reported states for the SNMP section :
<img src="/assets/img/device-configuration-api.5d94501b.png" alt="Device Desired and Reported through the API" title="API Device configuration"></p> <h3 id="re-applying-configuration-with-syncengine"><a href="#re-applying-configuration-with-syncengine" class="header-anchor">#</a> Re-Applying Configuration With SyncEngine</h3> <p>When a user applies a configuration change, DMP will send it to the device immediately or as soon as the device connects. However, if the device does not use the difference, DMP needs to re-apply the changes configured previously by the user. This is the job of SyncEngine.</p> <p>SyncEngine is an active agent in DMP in charge of detecting not applied differences in all devices and re-applying them following the policy set for the company to which the device belongs.</p> <p>This is how the SyncEngine can be configured:
<img src="/assets/img/sync-engine-endpoints.761d5c0e.png" alt="SyncEngine" title="SyncEngine"> <img src="/assets/img/sync-engine-parameters.b4980e97.png" alt="SyncEngine parameters" title="SyncEngine parameters"></p> <p>Sync Type &quot;Never&quot; disables the SyncEngine for the company. &quot;Forever&quot; will keep re-applying every &quot;retry_interval&quot; seconds until the device reports changes were applied. The custom mode will retry &quot;retry_attempts&quot; times.</p> <p>When installing or removing applications, SyncEngine also supervises the change following the company's policy. In addition, SyncEngine will ensure an application is changed, retrying if needed.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/gen2/explanations/companies-and-users/">
        Companies and Users
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.e1876cb4.js" defer></script><script src="/assets/js/2.7fa3ab1c.js" defer></script><script src="/assets/js/11.1c0925e2.js" defer></script><script src="/assets/js/21.9f4b6e13.js" defer></script>
  </body>
</html>
