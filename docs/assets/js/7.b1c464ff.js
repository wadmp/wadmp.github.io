(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{379:function(e,t,r){e.exports=r.p+"assets/img/GET_certs.10bc24fe.png"},530:function(e,t,r){e.exports=r.p+"assets/img/summary.a5a16c4c.png"},531:function(e,t,r){e.exports=r.p+"assets/img/BS_URL.8047ebd1.png"},532:function(e,t,r){e.exports=r.p+"assets/img/2_servers_a.1f27016b.png"},533:function(e,t,r){e.exports=r.p+"assets/img/2_servers_b.51796b3d.png"},534:function(e,t,r){e.exports=r.p+"assets/img/POST_bootstrap.064f179a.png"},535:function(e,t,r){e.exports=r.p+"assets/img/PUT_serverId.9a27d386.png"},536:function(e,t,r){e.exports=r.p+"assets/img/permission.6f61bf00.png"},537:function(e,t,r){e.exports=r.p+"assets/img/POST_trigger-bootstrap.3d919761.png"},585:function(e,t,r){"use strict";r.r(t);var o=r(35),a=Object(o.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"how-to-move-a-device-from-one-webaccess-dmp-management-server-to-another"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#how-to-move-a-device-from-one-webaccess-dmp-management-server-to-another"}},[e._v("#")]),e._v(" How to move a device from one WebAccess/DMP Management Server to another")]),e._v(" "),o("h2",{attrs:{id:"introduction"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[e._v("#")]),e._v(" Introduction")]),e._v(" "),o("h3",{attrs:{id:"background"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#background"}},[e._v("#")]),e._v(" Background")]),e._v(" "),o("p",[e._v("WebAccess/DMP follows the "),o("a",{attrs:{href:"https://www.omaspecworks.org/what-is-oma-specworks/iot/lightweight-m2m-lwm2m/",target:"_blank",rel:"noopener noreferrer"}},[e._v("LightWeightM2M"),o("OutboundLink")],1),e._v(' protocol for "Client-Initiated Bootstrap", using "Certificate mode with Enrollment over Secure Transport" for maximum security.')]),e._v(" "),o("p",[e._v("You do not need to understand this procedure to follow it, but it may provide helpful background information.")]),e._v(" "),o("p",[e._v('What you do need to understand is that a WebAccess/DMP server installation comprises several individual "servers":')]),e._v(" "),o("p",[o("img",{attrs:{src:r(530),alt:"summary block diagram"}})]),e._v(" "),o("p",[e._v("The Bootstrap Server is used to direct the client to one or more Management Servers.")]),e._v(" "),o("p",[e._v("During a bootstrap procedure, the Bootstrap Server provides two things to the client:")]),e._v(" "),o("ol",[o("li",[e._v("The address of the Management Server which will manage the device;")]),e._v(" "),o("li",[e._v("A security certificate that the client can use to identify itself to that Management Server.")])]),e._v(" "),o("p",[e._v("The Management Server performs all of the actual device management tasks: firmware upgrade, device configuration, device monitoring, etc.")]),e._v(" "),o("p",[e._v("The Management Server may occasionally direct the client to download a file from the Content Server, but the Content Server is irrelevant for this discussion.")]),e._v(" "),o("h3",{attrs:{id:"client-configuration"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#client-configuration"}},[e._v("#")]),e._v(" Client configuration")]),e._v(" "),o("p",[e._v("When a client on a device is starting for the first time, the only information it has is the address of a Bootstrap Server.")]),e._v(" "),o("p",[e._v('The following image is a screenshot of the "WebAccess/DMP Client" Router Apps running on the local webserver of a router:')]),e._v(" "),o("p",[o("img",{attrs:{src:r(531),alt:"local webserver"}}),e._v("\nNote that there is no way to directly configure the client to point to a new Management Server.")]),e._v(" "),o("p",[e._v("To move a device to a new Management Server, you have two choices.")]),e._v(" "),o("h3",{attrs:{id:"option-1"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#option-1"}},[e._v("#")]),e._v(" Option 1")]),e._v(" "),o("p",[e._v("Assuming you have access to the local web server on the device, you can change the Bootstrap Server Address in the Router App configuration screen.")]),e._v(" "),o("p",[o("img",{attrs:{src:r(532),alt:"option 1"}})]),e._v(" "),o("p",[e._v("However, there are disadvantages to this approach:")]),e._v(" "),o("ul",[o("li",[e._v("The configuration change can only be done manually;")]),e._v(" "),o("li",[e._v("The device will forget everything about the original Bootstrap Server. If the initial connection to the new Bootstrap Server (on Server 2) fails, the device is lost;")]),e._v(" "),o("li",[e._v("If the initial connection to the new Bootstrap Server (on Server 2) succeeds, but later Server 2 fails for some reason, it may not be possible to recover the device.")])]),e._v(" "),o("h3",{attrs:{id:"option-2"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#option-2"}},[e._v("#")]),e._v(" Option 2")]),e._v(" "),o("p",[e._v("Maintain the connection between the device and the original Bootstrap Server, but re-configure the Bootstrap Server to direct the device to the new Management Server.")]),e._v(" "),o("p",[o("img",{attrs:{src:r(533),alt:"option 2"}})]),e._v(" "),o("p",[e._v("Advantages:")]),e._v(" "),o("ul",[o("li",[e._v("The configuration change can be done via WebAccess/DMP itself and can therefore be automated for multiple devices;")]),e._v(" "),o("li",[e._v("If Server 2 fails for some reason, the device will always fall back to the original Bootstrap Server for new instructions;")]),e._v(" "),o("li",[e._v("This approach allows for new use-cases and business models. For example, you can temporarily move a device to a new Management Server, safe in knowing that when the new server dies, the device can be recovered.")])]),e._v(" "),o("p",[e._v("The rest of this article will explain the procedure for this approach (Option 2).")]),e._v(" "),o("blockquote",[o("p",[e._v("Note:\nThis procedure has been automated in a Jupyter Notebook that is available in our public GitHub repo:\n"),o("a",{attrs:{href:"https://github.com/wadmp/wadmp.github.io/blob/master/jupyter_notebooks/move_device.ipynb",target:"_blank",rel:"noopener noreferrer"}},[e._v("github.com/wadmp/wadmp.github.io/blob/master/jupyter_notebooks/move_device.ipynb"),o("OutboundLink")],1)])]),e._v(" "),o("h2",{attrs:{id:"general-case"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#general-case"}},[e._v("#")]),e._v(" General case")]),e._v(" "),o("p",[e._v("In the block diagrams above, we assume that the client on the device was initially configured to connect to the Bootstrap Server on Server 1.")]),e._v(" "),o("p",[e._v("Usually, the requirement is to move the device to a second server (Server 2) and possibly move it back again (to Server 1) later.")]),e._v(" "),o("p",[e._v("But we also need to consider the most general case. Imagine the device has already been moved from Server 1 to Server 2. Can we move it from Server 2 to Server 3? And from there to Server 4?")]),e._v(" "),o("p",[e._v("The answer is yes. The key is that the device always remembers the URL of its original Bootstrap Server.")]),e._v(" "),o("p",[e._v("In the "),o("a",{attrs:{href:"https://github.com/wadmp/wadmp.github.io/blob/master/jupyter_notebooks/move_device.ipynb",target:"_blank",rel:"noopener noreferrer"}},[e._v("Jupyter Notebook"),o("OutboundLink")],1),e._v(', you will see that the code handles the general case automatically. It refers to the original Bootstrap Server as "Server 0".')]),e._v(" "),o("p",[e._v("Usually, Server 0 "),o("em",[e._v("is")]),e._v(" Server 1. So to avoid over-complicating things, we will make that assumption for the remainder of this document.")]),e._v(" "),o("h2",{attrs:{id:"procedure"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#procedure"}},[e._v("#")]),e._v(" Procedure")]),e._v(" "),o("p",[e._v("All of the following steps can be performed using the public REST API of both servers.")]),e._v(" "),o("p",[e._v('You can follow along manually by using the "OpenAPI" (Swagger) documentation page, for example, '),o("a",{attrs:{href:"https://api.wadmp.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("api.wadmp.com"),o("OutboundLink")],1),e._v(".\nYou should have an equivalent page for the second server instance.")]),e._v(" "),o("p",[e._v("Alternatively, the whole procedure has been automated in a Jupyter Notebook that is available in our public GitHub repo: "),o("a",{attrs:{href:"https://github.com/wadmp/wadmp.github.io/blob/master/jupyter_notebooks/move_device.ipynb",target:"_blank",rel:"noopener noreferrer"}},[e._v("github.com/wadmp/wadmp.github.io/blob/master/jupyter_notebooks/move_device.ipynb"),o("OutboundLink")],1)]),e._v(" "),o("h3",{attrs:{id:"step-1-tell-the-bootstrap-server-to-which-management-server-the-device-should-be-directed"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#step-1-tell-the-bootstrap-server-to-which-management-server-the-device-should-be-directed"}},[e._v("#")]),e._v(" Step 1: Tell the Bootstrap Server to which Management Server the device should be directed")]),e._v(" "),o("p",[e._v("By default, in any particular WebAccess/DMP server deployment, the Bootstrap Server is configured to direct all devices to the Management Server co-located with the Bootstrap Server.")]),e._v(" "),o("p",[e._v("In this step, you configure the Bootstrap Server on Server 1 to direct a device to a "),o("em",[e._v("different")]),e._v(" Management Server: the Management Server on Server 2.")]),e._v(" "),o("h4",{attrs:{id:"step-1a"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#step-1a"}},[e._v("#")]),e._v(" Step 1a")]),e._v(" "),o("p",[o("strong",[o("em",[e._v("Using the Public API of Server 1 ...")])])]),e._v(" "),o("p",[e._v('In the Bootstrap section, send a POST request to "/bootstrap" to create a new Management Server definition:')]),e._v(" "),o("p",[o("img",{attrs:{src:r(534),alt:"POST /bootstrap endpoint"}})]),e._v(" "),o("ul",[o("li",[e._v('"name" is not essential: it only serves as a label or reminder for the user.')]),e._v(" "),o("li",[e._v('"address" is the IP address or DNS name of the Management Server.')]),e._v(" "),o("li",[e._v('"port" is the TCP port number of the Management Server. (Usually, 8883, which is the standard port number for MQTT over TLS.)\nFinally, * "company_id" is your company ID in the system. (Can be obtained using the GET /companies endpoint if you don\'t know it already.)')])]),e._v(" "),o("h4",{attrs:{id:"step-1b"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#step-1b"}},[e._v("#")]),e._v(" Step 1b")]),e._v(" "),o("p",[o("strong",[o("em",[e._v("Using the Public API of Server 1 ...")])])]),e._v(" "),o("p",[e._v('In the Devices section, send a PUT request to "/management/devices/{macAddress}/bootstrap-server/{serverId}", using the serverId obtained previously.')]),e._v(" "),o("p",[o("img",{attrs:{src:r(535),alt:"POST /bootstrap endpoint"}})]),e._v(" "),o("p",[e._v("This means that the next time the devices perform a Bootstrap procedure, they will be directed to the new Management Server.")]),e._v(" "),o("p",[e._v("But we are not ready to re-direct it yet.")]),e._v(" "),o("h3",{attrs:{id:"step-2-tell-the-new-management-server-to-trust-the-device-s-bootstrap-server"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#step-2-tell-the-new-management-server-to-trust-the-device-s-bootstrap-server"}},[e._v("#")]),e._v(" Step 2: Tell the new Management Server to trust the device's Bootstrap Server")]),e._v(" "),o("p",[e._v("The Management Server uses TLS with mutual authentication. i.e., The client must present a digital certificate. Furthermore, the Management Server must trust the "),o("em",[e._v("issuer")]),e._v(" of this certificate.")]),e._v(" "),o("p",[e._v("By default, the Bootstrap Server co-located with a Management Server is automatically trusted by that Management Server.")]),e._v(" "),o("p",[e._v("However, if your device has been directed to a "),o("em",[e._v("new")]),e._v(" Management Server, then by default, that Management Server will "),o("em",[e._v("not")]),e._v(" allow the device to connect because the client certificate presented was issued by an unknown Bootstrap Server.")]),e._v(" "),o("p",[e._v('You must update the "trust store" of the new Management Server with the certificates used by the device\'s Bootstrap Server.')]),e._v(" "),o("h4",{attrs:{id:"step-2a"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#step-2a"}},[e._v("#")]),e._v(" Step 2a")]),e._v(" "),o("p",[o("strong",[o("em",[e._v("Using the Public API of Server 1 ...")])])]),e._v(" "),o("p",[e._v('In the Bootstrap section, use the "GET /certs" endpoint to check what certificates are in the trust store of the current Management Server. i.e., The Management Server on Server 1, where the device is currently connected.')]),e._v(" "),o("p",[o("img",{attrs:{src:r(379),alt:"GET /certs endpoint"}})]),e._v(" "),o("blockquote",[o("p",[o("strong",[e._v("Permissions")])]),e._v(" "),o("p",[e._v('To use the "GET /certs" endpoint, you must have the "Device Management Server" permission on Server 1.')]),e._v(" "),o("p",[e._v("In the WebAccess/DMP UI, you can view and modify the permissions of any user (on a per-company basis):")]),e._v(" "),o("p",[o("img",{attrs:{src:r(536),alt:"The permissions screen in the UI"}})]),e._v(" "),o("p",[e._v('Alternatively, using the Public API, you can view permissions using the "GET /users/{id}" endpoint and modify them using the "PUT /users/{id}/companies" endpoint.')])]),e._v(" "),o("p",[e._v('The "GET /certs" request will return a JSON object like this:')]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v('{\n   "data": {\n      "certs": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0t...VElGSUNBVEUtLS0tLQo="\n   },\n   "success": true\n}\n')])])]),o("p",[e._v('"certs" is a Base64-encoded string. You can decode it using a web service like '),o("a",{attrs:{href:"https://www.base64decode.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("www.base64decode.org/"),o("OutboundLink")],1)]),e._v(" "),o("p",[e._v("When decoded, you will see that it is a PEM file containing several X.509 certificates, usually three:")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("-----BEGIN CERTIFICATE-----\nMIICzTCCAnOgAwIBAgIUHAGWV7GFmEummqHfcDEEr4HyM2MwCgYIKoZIzj0EAwIw\ngbMxCzAJBgNVBAYTAklFMQ8wDQYDVQQIDAZHYWx3YXkxETAPBgNVBAcMCE9yYW5t\n...\nDyWJ466GETl5oF8b036sAiBty23FHKQLWSa7v6Cl13LNPOP66FRDt0jneNZHF7QE\nwA==\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIICyDCCAm2gAwIBAgICEAEwCgYIKoZIzj0EAwIwgboxCzAJBgNVBAYTAklFMQ8w\nDQYDVQQIDAZHYWx3YXkxIDAeBgNVBAoMF0FkdmFudGVjaCBCK0IgU21hcnRXb3J4\n...\nBAMCAYYwCgYIKoZIzj0EAwIDSQAwRgIhAMZNGdhH1KOm33dA8yibKUQK8uDtKoJJ\n1zphLoEB3iOhAiEA9HOyt8t83eEGrdsL2Zdd9PaBaoK21MqU7vjA96L6xIM=\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIICxjCCAmugAwIBAgICEAAwCgYIKoZIzj0EAwIwgbMxCzAJBgNVBAYTAklFMQ8w\nDQYDVQQIDAZHYWx3YXkxETAPBgNVBAcMCE9yYW5tb3JlMSAwHgYDVQQKDBdBZHZh\n...\nAgGGMAoGCCqGSM49BAMCA0kAMEYCIQDVUuB//bFW1T900osnQgElyQq8Qe3uPG0h\nz6CnvTPHCAIhAKcu4nnZydZg1PTYwOZjZ54P5t+eIJKr3cL1Ts3J9Shb\n-----END CERTIFICATE-----\n")])])]),o("blockquote",[o("p",[o("strong",[e._v("Optional step")])]),e._v(" "),o("p",[e._v("If you are interested, you can split the file into individual certs and then use OpenSSL command-line tools to examine them:")]),e._v(" "),o("p",[o("code",[e._v("$ openssl x509 -in <cert> -text -noout")])]),e._v(" "),o("p",[e._v("You will see that the certificates are chained and end in a self-signed root CA cert.\nThis is the trust anchor for device authentication.")])]),e._v(" "),o("blockquote",[o("p",[o("strong",[e._v("Background info.")])]),e._v(" "),o("p",[e._v("If you are "),o("em",[e._v("really")]),e._v(" interested 😃, you should know that there is another way to check the Management Server's trust store without using the API.")]),e._v(" "),o("p",[e._v('During the TLS (v1.2) handshake, the server sends a "Certificate Request" message to the client.\nThis message includes the client Certificate Authorities listed in the server’s trust store.')]),e._v(" "),o("p",[e._v("If you use the "),o("code",[e._v("openssl s_client")]),e._v(' command to connect to the Management Server, the output will include "Acceptable client certificate CA names", already decoded for you:')]),e._v(" "),o("p",[o("code",[e._v("$ openssl s_client -connect management.wadmp.com:8883 -CAfile /opt/projects/pki/server/SCA0/certs/ca.cert.pem -tls1_2")])]),e._v(" "),o("p",[o("code",[e._v("CONNECTED(00000005)")])]),e._v(" "),o("p",[o("code",[e._v('depth=3 C = IE, ST = Galway, L = Oranmore, O = "Advantech B+B SmartWorx", OU = IoT, CN = Falcon Server Root CA (SCA0), emailAddress = bbcmsmanager@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v("verify return:1")])]),e._v(" "),o("p",[o("code",[e._v('depth=2 C = IE, ST = Galway, O = "Advantech B+B SmartWorx", OU = IoT, CN = Falcon Server Intermediate Level-1 CA (SCA1_production), emailAddress = webaccessdmp@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v("verify return:1")])]),e._v(" "),o("p",[o("code",[e._v('depth=1 C = IE, ST = Galway, O = "Advantech B+B SmartWorx", OU = IoT, CN = Falcon Server CA for Production (SCA2_production), emailAddress = webaccessdmp@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v("verify return:1")])]),e._v(" "),o("p",[o("code",[e._v('depth=0 C = IE, ST = Galway, L = Oranmore, O = "Advantech B+B SmartWorx", OU = IoT, CN = "WADMP Management Server, Production Cloud", emailAddress = webaccessdmp@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v("verify return:1")])]),e._v(" "),o("p",[o("code",[e._v("140025034838464:error:14094410:SSL routines:ssl3_read_bytes:sslv3 alert handshake failure:../ssl/record/rec_layer_s3.c:1528:SSL alert number 40")])]),e._v(" "),o("p",[o("code",[e._v("---")])]),e._v(" "),o("p",[o("code",[e._v("Certificate chain")])]),e._v(" "),o("p",[o("code",[e._v('0 s:C = IE, ST = Galway, L = Oranmore, O = "Advantech B+B SmartWorx", OU = IoT, CN = "WADMP Management Server, Production Cloud", emailAddress = webaccessdmp@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v('i:C = IE, ST = Galway, O = "Advantech B+B SmartWorx", OU = IoT, CN = Falcon Server CA for Production (SCA2_production), emailAddress = webaccessdmp@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v('1 s:C = IE, ST = Galway, O = "Advantech B+B SmartWorx", OU = IoT, CN = Falcon Server CA for Production (SCA2_production), emailAddress = webaccessdmp@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v('i:C = IE, ST = Galway, O = "Advantech B+B SmartWorx", OU = IoT, CN = Falcon Server Intermediate Level-1 CA (SCA1_production), emailAddress = webaccessdmp@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v('2 s:C = IE, ST = Galway, O = "Advantech B+B SmartWorx", OU = IoT, CN = Falcon Server Intermediate Level-1 CA (SCA1_production), emailAddress = webaccessdmp@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v('i:C = IE, ST = Galway, L = Oranmore, O = "Advantech B+B SmartWorx", OU = IoT, CN = Falcon Server Root CA (SCA0), emailAddress = bbcmsmanager@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v("---")])]),e._v(" "),o("p",[o("code",[e._v("Server certificate")])]),e._v(" "),o("p",[o("code",[e._v("-----BEGIN CERTIFICATE-----")])]),e._v(" "),o("p",[o("code",[e._v("MIIDSTCCAvCgAwIBAgICEAEwCgYIKoZIzj0EAwIwgbUxCzAJBgNVBAYTAklFMQ8w")])]),e._v(" "),o("p",[o("code",[e._v("DQYDVQQIDAZHYWx3YXkxIDAeBgNVBAoMF0FkdmFudGVjaCBCK0IgU21hcnRXb3J4")])]),e._v(" "),o("p",[o("code",[e._v("MQwwCgYDVQQLDANJb1QxOjA4BgNVBAMMMUZhbGNvbiBTZXJ2ZXIgQ0EgZm9yIFBy")])]),e._v(" "),o("p",[o("code",[e._v("b2R1Y3Rpb24gKFNDQTJfcHJvZHVjdGlvbikxKTAnBgkqhkiG9w0BCQEWGndlYmFj")])]),e._v(" "),o("p",[o("code",[e._v("Y2Vzc2RtcEBhZHZhbnRlY2guY29tMB4XDTE5MTAwMzEzMjc1NloXDTIwMTAwMjEz")])]),e._v(" "),o("p",[o("code",[e._v("Mjc1NlowgcAxCzAJBgNVBAYTAklFMQ8wDQYDVQQIDAZHYWx3YXkxETAPBgNVBAcM")])]),e._v(" "),o("p",[o("code",[e._v("CE9yYW5tb3JlMSAwHgYDVQQKDBdBZHZhbnRlY2ggQitCIFNtYXJ0V29yeDEMMAoG")])]),e._v(" "),o("p",[o("code",[e._v("A1UECwwDSW9UMTIwMAYDVQQDDClXQURNUCBNYW5hZ2VtZW50IFNlcnZlciwgUHJv")])]),e._v(" "),o("p",[o("code",[e._v("ZHVjdGlvbiBDbG91ZDEpMCcGCSqGSIb3DQEJARYad2ViYWNjZXNzZG1wQGFkdmFu")])]),e._v(" "),o("p",[o("code",[e._v("dGVjaC5jb20wWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASFexFsIrjfKwEufq1M")])]),e._v(" "),o("p",[o("code",[e._v("qgHlosaPLhAerIAtEb4lnwBMr22b+7WhnCIqlDCyTteRuXGZYuftNEaGQL/xQkKr")])]),e._v(" "),o("p",[o("code",[e._v("7/tRo4HiMIHfMAkGA1UdEwQCMAAwEQYJYIZIAYb4QgEBBAQDAgZAMDMGCWCGSAGG")])]),e._v(" "),o("p",[o("code",[e._v("+EIBDQQmFiRPcGVuU1NMIEdlbmVyYXRlZCBTZXJ2ZXIgQ2VydGlmaWNhdGUwHQYD")])]),e._v(" "),o("p",[o("code",[e._v("VR0OBBYEFGPi8TycsTD6SUrV3BwDkb5/XugjMB8GA1UdIwQYMBaAFCucwq3rviWz")])]),e._v(" "),o("p",[o("code",[e._v("QYQ2/+o0S3xrtqRZMA4GA1UdDwEB/wQEAwIFoDATBgNVHSUEDDAKBggrBgEFBQcD")])]),e._v(" "),o("p",[o("code",[e._v("ATAlBgNVHREEHjAcghRtYW5hZ2VtZW50LndhZG1wLmNvbYcEDU/2KTAKBggqhkjO")])]),e._v(" "),o("p",[o("code",[e._v("PQQDAgNHADBEAiA0M6lBmeiXfW9wmD/UOptPd+jeRAd+H4xutW3ZUBOwjAIgBKeD")])]),e._v(" "),o("p",[o("code",[e._v("ZD/bDFx1a1mT3+F977T5LQNWMUxxLLtJsQDtWDo=")])]),e._v(" "),o("p",[o("code",[e._v("-----END CERTIFICATE-----")])]),e._v(" "),o("p",[o("code",[e._v('subject=C = IE, ST = Galway, L = Oranmore, O = "Advantech B+B SmartWorx", OU = IoT, CN = "WADMP Management Server, Production Cloud", emailAddress = webaccessdmp@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v('issuer=C = IE, ST = Galway, O = "Advantech B+B SmartWorx", OU = IoT, CN = Falcon Server CA for Production (SCA2_production), emailAddress = webaccessdmp@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v("---")])]),e._v(" "),o("p",[o("strong",[o("code",[e._v("Acceptable client certificate CA names")])])]),e._v(" "),o("p",[o("code",[e._v('C = IE, ST = Galway, O = "Advantech B+B SmartWorx", OU = IoT, CN = Falcon Device CA for Production (DCA2_production), emailAddress = webaccessdmp@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v('C = IE, ST = Galway, O = "Advantech B+B SmartWorx", OU = IoT, CN = Falcon Device Intermediate Level-1 CA (DCA1_production), emailAddress = webaccessdmp@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v('C = IE, ST = Galway, L = Oranmore, O = "Advantech B+B SmartWorx", OU = IoT, CN = Falcon Device Root CA (DCA0), emailAddress = bbcmsmanager@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v('C = IE, ST = Galway, O = "Advantech B+B SmartWorx", OU = IoT, CN = Falcon Device CA for Development Environment (DCA2_develop), emailAddress = bbcmsmanager@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v('C = IE, ST = Galway, O = "Advantech B+B SmartWorx", OU = IoT, CN = Falcon Test Device Intermediate Level-1 CA (DCA1_test), emailAddress = bbcmsmanager@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v('C = IE, ST = Galway, L = Oranmore, O = "Advantech B+B SmartWorx", OU = IoT, CN = Falcon User CA (UCA_Advantech1), emailAddress = ben.kinsella@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v('C = IE, ST = Galway, O = "Advantech B+B SmartWorx", OU = IoT, CN = WADMP Device CA for Staging, emailAddress = webaccessdmp@advantech.com')])]),e._v(" "),o("p",[o("code",[e._v("Client Certificate Types: RSA sign, DSA sign, ECDSA sign")])]),e._v(" "),o("p",[o("code",[e._v("Requested Signature Algorithms: ECDSA+SHA256:ECDSA+SHA384:ECDSA+SHA512:Ed25519:Ed448:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA+SHA256:RSA+SHA384:RSA+SHA512:ECDSA+SHA224:ECDSA+SHA1:RSA+SHA224:RSA+SHA1:DSA+SHA224:DSA+SHA1:DSA+SHA256:DSA+SHA384:DSA+SHA512")])]),e._v(" "),o("p",[o("code",[e._v("Shared Requested Signature Algorithms: ECDSA+SHA256:ECDSA+SHA384:ECDSA+SHA512:Ed25519:Ed448:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA-PSS+SHA256:RSA-PSS+SHA384:RSA-PSS+SHA512:RSA+SHA256:RSA+SHA384:RSA+SHA512:ECDSA+SHA224:ECDSA+SHA1:RSA+SHA224:RSA+SHA1:DSA+SHA224:DSA+SHA1:DSA+SHA256:DSA+SHA384:DSA+SHA512")])]),e._v(" "),o("p",[o("code",[e._v("Peer signing digest: SHA256")])]),e._v(" "),o("p",[o("code",[e._v("Peer signature type: ECDSA")])]),e._v(" "),o("p",[o("code",[e._v("Server Temp Key: X25519, 253 bits")])]),e._v(" "),o("p",[o("code",[e._v("---")])]),e._v(" "),o("p",[o("code",[e._v("SSL handshake has read 3867 bytes and written 328 bytes")])]),e._v(" "),o("p",[o("code",[e._v("Verification: OK")])]),e._v(" "),o("p",[o("code",[e._v("---")])]),e._v(" "),o("p",[o("code",[e._v("New, TLSv1.2, Cipher is ECDHE-ECDSA-AES256-GCM-SHA384")])]),e._v(" "),o("p",[o("code",[e._v("Server public key is 256 bit")])]),e._v(" "),o("p",[o("code",[e._v("Secure Renegotiation IS supported")])]),e._v(" "),o("p",[o("code",[e._v("Compression: NONE")])]),e._v(" "),o("p",[o("code",[e._v("Expansion: NONE")])]),e._v(" "),o("p",[o("code",[e._v("No ALPN negotiated")])]),e._v(" "),o("p",[o("code",[e._v("SSL-Session:")])]),e._v(" "),o("p",[o("code",[e._v("Protocol : TLSv1.2")])]),e._v(" "),o("p",[o("code",[e._v("Cipher : ECDHE-ECDSA-AES256-GCM-SHA384")])]),e._v(" "),o("p",[o("code",[e._v("Session-ID:")])]),e._v(" "),o("p",[o("code",[e._v("Session-ID-ctx:")])]),e._v(" "),o("p",[o("code",[e._v("Master-Key: C92E036601E64921EA5F20D39A0A9FF53A3B6BDB709DD2819A4AF7A968D1E6F0AF7961593E0792139B7B15EEC5340E78")])]),e._v(" "),o("p",[o("code",[e._v("PSK identity: None")])]),e._v(" "),o("p",[o("code",[e._v("PSK identity hint: None")])]),e._v(" "),o("p",[o("code",[e._v("SRP username: None")])]),e._v(" "),o("p",[o("code",[e._v("Start Time: 1590769106")])]),e._v(" "),o("p",[o("code",[e._v("Timeout : 7200 (sec)")])]),e._v(" "),o("p",[o("code",[e._v("Verify return code: 0 (ok)")])]),e._v(" "),o("p",[o("code",[e._v("Extended master secret: yes")])]),e._v(" "),o("p",[o("code",[e._v("---")])])]),e._v(" "),o("h4",{attrs:{id:"step-2b"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#step-2b"}},[e._v("#")]),e._v(" Step 2b")]),e._v(" "),o("p",[o("strong",[o("em",[e._v("Using the Public API of Server 2 ...")])])]),e._v(" "),o("p",[e._v('Use the same "GET /certs" endpoint on Server 2 to check what certificates are in the trust store of the '),o("em",[e._v("new")]),e._v(" Management Server.")]),e._v(" "),o("p",[e._v('Decode the "certs" string as before.')]),e._v(" "),o("h4",{attrs:{id:"step-2c"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#step-2c"}},[e._v("#")]),e._v(" Step 2c")]),e._v(" "),o("p",[e._v("Any certificate in Server 1 that is NOT already in Server 2 must be added to Server 2.")]),e._v(" "),o("p",[e._v("Copy and paste the concatenated certificates into a web service like "),o("a",{attrs:{href:"https://www.base64encode.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("www.base64encode.org/"),o("OutboundLink")],1),e._v(". The order of the certificates doesn't matter.")]),e._v(" "),o("p",[o("strong",[o("em",[e._v("Using the Public API of Server 2 ...")])])]),e._v(" "),o("p",[e._v('In the Bootstrap section, use the "PUT /certs" endpoint to upload the new Base64-encoded string as "certs".')]),e._v(" "),o("p",[e._v("i.e., Pass the following JSON object in the body:")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v('{\n   "certs": "<new Base64-encoded string including new certs>"\n}\n')])])]),o("p",[o("img",{attrs:{src:r(379),alt:"GET /certs endpoint"}})]),e._v(" "),o("blockquote",[o("p",[o("strong",[e._v("Permissions")])]),e._v(" "),o("p",[e._v('To use the "PUT /certs" endpoint, you must be a SysAdmin on Server 2.')]),e._v(" "),o("ul",[o("li",[o("p",[e._v("If your Server 2 instance is an On-Premises installation of WebAccess/DMP, there will be a SysAdmin user within your organization.")])]),e._v(" "),o("li",[o("p",[e._v("If your Server 2 instance is the public cloud installation of WebAccess/DMP (www.wadmp.com), only Advantech SysAdmin has permission to perform this step.")])])])]),e._v(" "),o("blockquote",[o("p",[o("strong",[e._v("Optional step")])]),e._v(" "),o("p",[e._v("If you used the "),o("code",[e._v("openssl s_client")]),e._v(' command earlier, you could rerun it now, and you should find the new client CA(s) listed under "Acceptable client certificate CA names".')])]),e._v(" "),o("h3",{attrs:{id:"step-3-trigger-a-new-bootstrap-procedure"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#step-3-trigger-a-new-bootstrap-procedure"}},[e._v("#")]),e._v(" Step 3: Trigger a new Bootstrap procedure")]),e._v(" "),o("p",[o("strong",[o("em",[e._v("Using the Public API of Server 1 ...")])])]),e._v(" "),o("p",[e._v('In the Devices section, use the "POST /management/devices/{macAddress}/commands/trigger-bootstrap" endpoint to command the device to initiate a new bootstrap process:')]),e._v(" "),o("p",[o("img",{attrs:{src:r(537),alt:"POST /trigger-bootstrap endpoint"}})]),e._v(" "),o("p",[e._v("The device will receive a new certificate from the Bootstrap Server, and it will also receive the address of the new Management Server (on Server 2).")]),e._v(" "),o("p",[e._v("It will attempt to connect to Server 2 immediately.")]),e._v(" "),o("p",[e._v("The connection will be successful if:")]),e._v(" "),o("ol",[o("li",[o("p",[e._v("The X.509 certificates were copied to Server 2 as described in this procedure;")])]),e._v(" "),o("li",[o("p",[e._v('The device identity exists in Server 2. i.e., Use the "Create Device" screen in the WebAccess/DMP UI or the "POST /identity/devices" endpoint in the API.')])])])])}),[],!1,null,null,null);t.default=a.exports}}]);